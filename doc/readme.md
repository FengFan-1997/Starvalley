星露谷物语参考设计与 H5/Vue3/Node 技术落地文档
文档说明
本文档围绕《星露谷物语（Stardew Valley）》的核心设计逻辑，结合 Vue3 + JS + H5 + CSS/Less + Node.js + Vite 技术栈，从游戏操作体系、基础玩法系统、画面实现逻辑、交互设计与落地、后端架构设计五个核心维度展开，为复刻 / 参考该游戏的 H5 项目提供全流程指导。
1. 星露谷物语核心概述
1.1 游戏定位与核心体验
《星露谷物语》是由 ConcernedApe 开发的像素风农场经营 RPG，核心定位是「田园回归 + 自由探索」，核心体验包含：
慢节奏治愈：以农场经营为核心，无强制任务，玩家可自由安排每日行为（种植、钓鱼、社交等）；
高自由度：支持多维度玩法（种植、养殖、采矿、战斗、社交、剧情），玩法间形成闭环；
情感化羁绊：NPC 有独立人设、喜好和剧情线，好感度提升解锁专属内容（结婚、特殊道具）；
像素复古美学：2D 俯视格子化地图，暖色调像素风格，UI 简洁且贴合田园主题。
1.2 技术参考价值
星露谷的底层设计高度适配 H5 / 前端技术栈：
2D 俯视格子化地图 → 可通过 Canvas/WebGL 高效渲染；
状态驱动的交互逻辑 → 可通过 Vue3+Pinia 实现状态统一管理；
数值闭环的玩法系统 → 可通过 Node.js 实现数据持久化与校验；
像素风格渲染 → 适配 H5 的 Canvas 像素渲染特性，开发成本低；
模块化 UI → 可通过 Vue3 组件化 + Less 样式模块化实现复用。
2. 星露谷物语操作体系详解
2.1 核心操作维度（适配 H5 多端）
星露谷原生支持键鼠（PC）、手柄（主机 / PC）、触屏（移动端），H5 项目需重点适配键鼠 + 触屏：
操作维度	原生支持	H5 适配方案
键鼠	WASD / 方向键移动、鼠标点击交互	完全复用原生逻辑，监听keydown/keyup和mousedown/mouseup
手柄	左摇杆移动、ABXY 键交互	H5 可选支持（通过gamepad API），非核心优先级
触屏	虚拟摇杆移动、点击 / 长按交互	移动端显示虚拟摇杆组件，绑定touchstart/touchend/touchmove
2.2 基础操作指令（分模块）
2.2.1 移动操作
核心逻辑：角色基于格子地图 8 方向移动，有碰撞检测（不可穿墙 / 障碍物），移动速度受地形 / 状态影响；
具体指令：
键鼠：WASD / 方向键控制移动，Shift 键加速（奔跑，消耗体力）；
触屏：虚拟摇杆控制方向，摇杆长按触发奔跑；
边界规则：角色坐标严格锚定格子（如 32px / 格），移动前检测目标格子是否可通行。
2.2.2 交互操作
核心逻辑：交互有距离阈值（角色与交互物≤1 格），操作有优先级（对话 > 采集 > 物品放置）；
具体指令：
键鼠：左键「核心交互」（采集、对话、打开箱子），右键「辅助交互」（送礼、放置物品、查看信息）；
触屏：点击「核心交互」，长按「辅助交互」，长按后弹出操作菜单（送礼 / 查看）；
冷却规则：同个交互物短时间内仅触发一次（如避免连续点击 NPC 重复对话）。
2.2.3 物品管理操作
核心逻辑：物品有堆叠上限，工具栏快捷切换，背包 / 箱子支持物品转移；
具体指令：
键鼠：鼠标拖拽物品（背包↔箱子↔工具栏），数字键 1-9 切换工具栏物品，ESC 打开全局菜单；
触屏：拖拽物品转移，点击工具栏格子切换物品，点击右上角按钮打开全局菜单；
堆叠规则：同类同品质物品可堆叠（如普通萝卜最多 99 个 / 格），不同品质不可堆叠。
2.2.4 战斗操作（矿洞 / 怪物区域）
核心逻辑：武器有攻击范围 / 冷却，受击有硬直，生命值 / 体力消耗与恢复闭环；
具体指令：
键鼠：左键挥砍武器 / 工具，右键使用道具（回血 / 炸弹），方向键躲避；
触屏：点击怪物攻击，快捷栏点击道具使用，虚拟摇杆移动躲避；
硬直规则：攻击 / 受击后短时间（0.3s）无法移动 / 攻击，避免无成本操作。
2.2.5 特殊交互操作（钓鱼 / 采矿）
钓鱼：长按收杆（左键 / A 键），根据鱼的移动调整进度条位置，松开避免脱钩，成功率与钓鱼等级 / 道具挂钩；
采矿：点击矿石（左键 / A 键），不同矿石需对应等级镐子，按住键蓄力提升攻击伤害，矿石有耐久值。
2.3 操作逻辑设计（前端落地铺垫）
2.3.1 状态机设计
角色状态互斥，避免操作冲突，核心状态包含：
js
// 角色状态枚举（前端可封装为常量）
const PLAYER_STATE = {
  IDLE: 'idle',       // 站立
  MOVE: 'move',       // 移动
  INTERACT: 'interact',// 交互（采集/对话）
  COMBAT: 'combat',   // 战斗
  FISHING: 'fishing', // 钓鱼
  MINING: 'mining'    // 采矿
}
示例规则：钓鱼状态下无法移动 / 战斗，交互状态下无法攻击。
2.3.2 操作优先级
plaintext
核心操作（移动/交互）> 辅助操作（物品切换）> 菜单操作（ESC）> 系统操作（设置）
示例：移动中点击交互物，优先触发交互，暂停移动；打开菜单后，所有操作仅响应菜单内指令。
2.3.3 输入防抖 / 节流
防抖：交互操作添加 200ms 防抖（如连续点击 NPC 仅触发一次对话）；
节流：移动指令 16ms 节流（与屏幕刷新率同步），避免频繁触发坐标更新。
3. 星露谷物语基础玩法系统拆解
3.1 核心玩法循环
星露谷的核心循环是「资源获取→加工→消耗 / 交易→解锁新内容→效率提升」，形成闭环：
plaintext
种植/养殖/采矿/钓鱼/采集 → 厨房/工坊加工 → 售卖/送礼/任务/升级 → 解锁地块/工具/区域 → 技能/工具升级 → 资源获取效率提升
3.2 细分玩法模块（核心）
3.2.1 种植系统
核心流程	规则细节	数值关联
开垦土地（锄头）	仅可开垦草地格子，开垦消耗 2 点体力	耕种等级≥1 解锁高级锄头（减少体力消耗）
播种（种子）	种子仅对应季节生长（如春季萝卜、夏季番茄），跨季枯萎	种子价格随等级提升降低，稀有种子需解锁
浇水（水壶）	每日需浇水，雨天自动浇水，水壶升级后单次浇水范围扩大	水壶等级：铜（3 格）→铁（5 格）→金（7 格）→铱（9 格）
成熟收获	不同作物生长周期不同（1-14 天），品质分普通 / 银 / 金 / 铱	品质越高，售价 / 送礼好感度加成越高
肥料使用	肥料提升品质 / 加速生长，需种植前施加	高级肥料需耕种等级解锁，成本更高
3.2.2 养殖系统
核心流程：建造畜棚 / 鸡舍 → 购买动物 → 喂食 → 收集产物 → 好感度提升 → 产物品质提升；
核心规则：
动物好感度（0-5 心）：低好感度停止产奶 / 蛋，抚摸 / 喂食提升好感；
季节适配：冬季需加热器，否则动物生病，停止产仔；
产物加工：牛奶→奶酪、鸡蛋→蛋黄酱，加工后价值提升 50%-100%。
3.2.3 采矿与锻造系统
核心流程：进入矿洞（1-120 层）→ 采矿 → 收集矿石 / 宝石 → 锻造升级工具 / 装备；
核心规则：
矿洞分层难度：层数越深，矿石越稀有（铜→铁→金→铱），怪物越强；
工具锻造：需矿石 + 煤炭，镐子升级后可开采更高等级矿石（如金镐可开采铱矿）；
死亡惩罚：矿洞死亡掉落部分物品，回到矿洞入口，保留当前层数进度。
3.2.4 钓鱼系统
核心流程：装备鱼竿 → 抛竿（长按蓄力）→ 鱼上钩 → 控制进度条捕获；
核心规则：
鱼的分布：时间（早 / 中 / 晚）、天气（晴 / 雨 /
 雪）、地点（湖 / 河 / 海）决定鱼的种类；
难度分级：普通鱼（难度 1-3）、稀有鱼（难度 4-6）、传说鱼（难度 7-10，仅特定条件出现）；
道具加成：鱼饵提升上钩率，浮标提升进度条控制精度。
3.2.5 社交系统
核心流程：对话（每日 1 次提升好感）→ 送礼（匹配喜好提升更多）→ 解锁剧情 / 奖励；
核心规则：
好感度心级：0-10 心，每心对应固定好感值（如 1 心需 250 点，10 心需 2500 点）；
喜好体系：每个 NPC 有「最爱 / 喜欢 / 普通 / 讨厌 / 憎恶」物品（如潘姆喜欢啤酒，厌恶钻石）；
节日加成：花舞节（12 月 25 日），好感度提升 10 心，所有物品价值提升 100%。
