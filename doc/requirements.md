# 星露谷物语 (Stardew Valley) 复刻版需求规格说明书

## 1. 背景说明
本项目旨在基于 Vue3 + TypeScript + Pinia + Pixi.js 技术栈，开发一款高还原度的《星露谷物语》H5 网页游戏。项目需严格遵循原作的核心玩法循环（资源收集-生产加工-价值变现-成长解锁），并适配桌面端与移动端交互。本文档基于 `doc/two.md` 与 `doc/readme.md` 整合制定，作为后续开发的唯一需求基准。

## 2. 功能需求详解

### 2.1 核心游戏循环 (Game Loop)
- **时间系统**：
  - 游戏内 1 小时 ≈ 现实 1 分钟。
  - 每日 06:00 开始，次日 02:00 强制结束。
  - **关键时间点**：
    - 22:00：时间显示变黄，提示玩家回家。
    - 24:00：时间显示变红，提示迫切。
    - 02:00：强制昏迷，扣除一定金币（上限 1000G）并恢复部分体力次日醒来。
- **季节系统**：
  - 春、夏、秋、冬四季轮换，每季 28 天。
  - 换季时：所有非跨季作物枯萎，地面杂物刷新。
- **体力系统**：
  - 初始上限 100 点。
  - 消耗行为：使用工具（锄头、水壶、斧头、镐子、钓竿）。
  - 恢复行为：吃食物、睡觉、泡温泉。
  - 耗尽惩罚：体力归零时进入“疲惫”状态（移动减慢，无法跑步），再次使用工具会导致昏迷。

### 2.2 农场经营系统 (Farming)
- **土地管理**：
  - **清理**：使用斧头/镐子/镰刀清理树木、石头、杂草。
  - **耕地**：使用锄头将草地/泥土变为耕地。
  - **施肥**：在耕地上使用肥料，提升作物生长速度或品质。
- **作物种植**：
  - **播种**：在耕地上种植种子，需符合当季作物要求。
  - **浇水**：未浇水（土地颜色较浅）作物当日不生长，且可能枯萎。
  - **生长**：作物有多个生长阶段（如：种子 -> 发芽 -> 成长 -> 成熟）。
  - **收获**：成熟后点击收获，获得作物物品。
- **工具升级**：
  - 喷壶/锄头蓄力可增加作用范围（铜：3格，铁：5格，金：3x3，铱：6x3）。

### 2.3 物品与库存系统 (Inventory)
- **背包**：
  - 初始 12 格快捷栏 + 24 格背包空间（共 36 格）。
  - 支持物品堆叠（上限 999）。
  - 支持物品拖拽交换位置。
  - 物品分类：工具、装备、种子、作物、鱼类、矿物、垃圾、家具。
- **箱子**：
  - 制造并放置箱子，提供额外的 36 格存储空间。
  - 支持颜色自定义。
- **交易**：
  - **出货箱**：放入物品，次日结算获得金币。
  - **商店**：在皮埃尔商店/Joja超市购买种子、背包扩容；在铁匠铺升级工具。

### 2.4 社交与剧情系统 (Social)
- **NPC 交互**：
  - 每日对话：+10 好感度（每日限一次）。
  - **送礼**：
    - 每周限 2 次，每日限 1 次。
    - 最爱 (+80)，喜欢 (+45)，普通 (+20)，不喜欢 (-20)，讨厌 (-40)。
    - 生日送礼效果 x8。
- **好感度**：
  - 0-10 心（每心 250 点）。
  - 达到特定好感度触发“剧情事件”（Cutscenes）。
- **结婚**：单身 NPC 好感度达标后可赠送“美人鱼吊坠”求婚。

### 2.5 采集与探索系统 (Exploration)
- **采集**：
  - 全地图随机生成季节性野果/贝壳。
  - 砍伐树木获得木头/树液/种子。
- **矿洞**：
  - 120 层深度，每 5 层解锁电梯。
  - **采矿**：敲击矿石获得铜/铁/金/铱矿及石头/煤炭。
  - **战斗**：即时战斗，使用剑/锤/匕首攻击怪物（史莱姆、蝙蝠等）。
- **钓鱼**：
  - 抛竿蓄力决定距离。
  - 迷你游戏：控制绿色滑块覆盖鱼的图标，进度条满则钓起。
  - 鱼类分布受季节、天气、地点、时间影响。

### 2.6 制造与建筑系统 (Crafting)
- **随身制造**：打开菜单，消耗背包材料制作物品（如火把、箱子、熔炉）。
- **建筑建造**：在木匠罗宾处消耗金币和材料建造/升级农场建筑（鸡舍、畜棚、井、筒仓）。

## 3. UI 与交互需求

### 3.1 常驻 HUD
- **时间/日期**：右上角显示，包含天气图标。
- **金币**：显示当前持有金币，变动时有滚动特效。
- **快捷栏**：底部居中 12 格，键盘 1-= 或滚轮切换，高亮当前选中项。
- **状态条**：右下角垂直显示体力条（E）和生命条（H，仅战斗/受伤显示）。

### 3.2 菜单系统 (Tab Menu)
- **背包**：物品管理、垃圾桶删除。
- **技能**：显示 5 大技能（耕种、采矿、觅食、钓鱼、战斗）等级及进度。
- **社交**：NPC 列表、好感度心级、本周礼物赠送情况。
- **地图**：显示世界地图及玩家位置。
- **制作**：已解锁配方列表，点击制作。
- **设置**：音量、缩放、控制模式、保存/退出。

### 3.3 交互逻辑
- **键鼠操作**：
  - WASD 移动。
  - 鼠标左键：使用工具/攻击/主要交互。
  - 鼠标右键：次要交互（吃东西/检查/对话/送礼）。
  - Shift：按住奔跑（或切换自动奔跑）。
- **触屏操作 (移动端适配)**：
  - **虚拟摇杆**：屏幕左下角控制移动 (Walk/Run 由推杆幅度或长按决定)。
  - **点击交互**：点击屏幕对象触发主要交互。
  - **长按菜单**：长按对象弹出辅助操作菜单 (查看/送礼)。
- **视觉反馈**：
  - 交互光标：鼠标悬停可交互物体时，光标变为手型或对话气泡。
  - 选中提示：耕地/浇水时，显示高亮网格指示作用地块。
  - 飘字：获得物品、扣血、恢复体力、获得经验时有浮动文字。

### 3.4 UI 视觉规范 (Visual Style)
- **风格**：严格的像素艺术 (Pixel Art) 风格。
- **字体**：统一使用像素字体 (如 `Press Start 2P` 或类似)，保证低分辨率下的清晰度。
- **配色体系**：
  - **基础**：暖棕色 (木质面板/边框)、深灰色 (背景遮罩)。
  - **功能色**：
    - 绿色 (#5C9E56)：体力、确认按钮、生长。
    - 红色 (#D94C4C)：生命、取消按钮、警告。
    - 金色 (#FFD700)：高亮选中、奖励、稀有物品。
- **动态效果**：所有 UI 动效 (弹窗、进度条) 需使用 CSS3 像素级过渡，避免平滑模糊。

## 4. 技术与约束条件

### 4.1 数据结构与持久化
- **存档格式** (JSON)：
  - 玩家信息 (Player): 金币、当前体力/生命、经验值、已解锁配方。
  - 物品栏 (Inventory): 物品 ID、数量、品质。
  - 世界状态 (World):
    - 日期/季节/天气。
    - 地块数据 (Plots): 每一格的状态（是否有作物/生长阶段/浇水/肥料）。
    - 放置物 (Objects): 箱子、机器的位置与内容。
  - NPC 状态: 好感度、已对话/已送礼标志。
- **存储方式**：
  - 本地开发：`localStorage`。
  - 生产环境：预留 RESTful API 接口 (`/api/save`, `/api/load`) 对接 Node.js 后端。

### 4.2 性能约束
- **渲染**：使用 Pixi.js 保证大量地块（如 100x100 农场）渲染达到 60 FPS。
- **逻辑**：游戏逻辑（时间流逝、作物生长）与渲染循环解耦。
- **资源**：像素资源使用 Sprite Sheet 优化加载。

### 4.3 假设
- 初始版本仅包含“标准农场”地图。
- 暂时仅实现单人模式，不考虑多人联机。
- 优先适配 PC 浏览器 (1920x1080 基准)，后续适配移动端触屏。
